function zip(arrays) {
    return Array.apply(null,Array(arrays[0].length)).map(function(_,i){
        return arrays.map(function(array){ return array[i]; });
                                                         });
}

function boundsImage(lat, lng) {
    var lngString = Math.abs(lng).toString();
    if (lngString.length < 3) {
        lngString = "0" + lngString;
    }
    return [new google.maps.LatLngBounds(
                new google.maps.LatLng(lat, lng),
                new google.maps.LatLng(lat + 1, lng + 1)),
            "K13/N" + Math.abs(lat) + "W" + lngString + ".png"];
}

function initialize() {
    var quadrants =
[[37, -120], [37, -119], [38, -119], [41, -123], [50, -114], [44, -72], [40, -113], [48, -116], [43, -116], [44, -116], [44, -115], [36, -106], [36, -105], [37, -105], [50, -115], [51, -115], [48, -119], [48, -118], [48, -117], [49, -120], [49, -119], [49, -118], [49, -117], [50, -120], [50, -119], [50, -118], [38, -105], [51, -120], [47, -120], [48, -122], [48, -121], [48, -120], [53, -132], [53, -131], [53, -130], [53, -129], [53, -128], [54, -132], [55, -132], [56, -132], [57, -132], [58, -132], [42, -112], [42, -111], [43, -112], [60, -149], [61, -150], [61, -149], [44, -112], [49, -116], [37, -106], [38, -106], [45, -123], [45, -110], [46, -123], [60, -150], [47, -124], [47, -123], [48, -124], [48, -123], [51, -119], [51, -118], [52, -118], [52, -117], [43, -111], [43, -110], [44, -111], [44, -110], [48, -67], [48, -66], [49, -67], [49, -66], [45, -112], [45, -111], [59, -136], [59, -135], [60, -136], [60, -135], [38, -110], [37, -110], [49, -125], [50, -125], [51, -126], [51, -125], [43, -115], [41, -113], [41, -112], [36, -109], [36, -108], [36, -107], [37, -109], [37, -108], [37, -107], [39, -112], [45, -116], [45, -115], [45, -114], [46, -116], [46, -115], [46, -114], [47, -116], [47, -115], [47, -114], [40, -112], [40, -111], [49, -127], [49, -126], [50, -127], [50, -126], [52, -124], [52, -123], [52, -122], [52, -121], [52, -120], [52, -119], [53, -124], [53, -123], [53, -122], [53, -121], [53, -120], [53, -119], [54, -124], [54, -123], [54, -122], [54, -121], [54, -120], [54, -119], [55, -124], [55, -123], [55, -122], [55, -121], [55, -120], [55, -119], [56, -124], [56, -123], [56, -122], [56, -121], [56, -120], [56, -119], [38, -109], [39, -109], [49, -124], [49, -123], [49, -122], [49, -121], [50, -124], [50, -123], [50, -122], [50, -121], [51, -124], [51, -123], [51, -122], [51, -121], [40, -108], [41, -108], [41, -107], [45, -122], [45, -121], [46, -122], [46, -121], [50, -117], [50, -116], [51, -117], [51, -116], [39, -106], [40, -107], [40, -106], [47, -122], [47, -121], [48, -115], [48, -114], [49, -115], [49, -114], [38, -121], [38, -120], [39, -121], [39, -120], [54, -131], [54, -130], [54, -129], [54, -128], [54, -127], [55, -131], [55, -130], [55, -129], [55, -128], [55, -127], [56, -131], [56, -130], [56, -129], [56, -128], [56, -127], [57, -131], [57, -130], [57, -129], [57, -128], [57, -127], [58, -131], [58, -130], [58, -129], [58, -128], [58, -127], [38, -108], [38, -107], [39, -108], [39, -107]];

    var skiAreas =
[["Barrett Ridge",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [41.32594, -106.525665],
  [41.333706, -106.519104],
  [41.33477, -106.52035],
  [41.328712, -106.52807]],
 ["Libby Creek",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [41.315594, -106.15814],
  [41.34289, -106.18462],
  [41.34811, -106.21106],
  [41.348595, -106.21758],
  [41.3465, -106.2193],
  [41.340443, -106.210625],
  [41.329227, -106.19728],
  [41.325874, -106.19565]],
 ["Seven Utes Mountain",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [40.503685, -105.933266],
  [40.49755, -105.926056],
  [40.476727, -105.92769],
  [40.47705, -105.93318],
  [40.483124, -105.94236],
  [40.488605, -105.94245]],
 ["Fern Lake",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [40.329926, -105.68118],
  [40.332085, -105.67148],
  [40.337975, -105.675644],
  [40.34913, -105.666374],
  [40.354885, -105.63119],
  [40.350796, -105.66389],
  [40.349358, -105.66998],
  [40.338924, -105.67766]],
 ["Hidden Valley",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [40.39425, -105.65385],
  [40.393726, -105.68015],
  [40.388268, -105.68599],
  [40.382217, -105.68187],
  [40.37967, -105.67371],
  [40.38477, -105.65921]],
 ["Rock Creek",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [40.17389, -105.52703],
  [40.159264, -105.56076],
  [40.16182, -105.58711],
  [40.15103, -105.5596],
  [40.150932, -105.54711],
  [40.149586, -105.53866],
  [40.159985, -105.53686]],
 ["St. Mary’s Glacier",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [39.82785, -105.6423],
  [39.82627, -105.64432],
  [39.8325, -105.65011],
  [39.834606, -105.65054],
  [39.836353, -105.649124],
  [39.83596, -105.64702],
  [39.834015, -105.64625],
  [39.83151, -105.64599],
  [39.8295, -105.64492]],
 ["Berthoud Pass",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [39.809624, -105.77834],
  [39.810413, -105.784004],
  [39.81002, -105.78774],
  [39.805008, -105.793015],
  [39.801613, -105.79383],
  [39.795742, -105.785805],
  [39.791126, -105.78066],
  [39.793697, -105.77264],
  [39.798744, -105.762245],
  [39.8025, -105.76551],
  [39.805435, -105.76937]],
 ["Jones Pass",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [39.770546, -105.85069],
  [39.7719, -105.858376],
  [39.77655, -105.86396],
  [39.781433, -105.865204],
  [39.77873, -105.86696],
  [39.777573, -105.8698],
  [39.777905, -105.87387],
  [39.778465, -105.8752],
  [39.77401, -105.889404],
  [39.7687, -105.8749],
  [39.75554, -105.86224],
  [39.750755, -105.858635],
  [39.756626, -105.8543]],
 ["Geneva Basin",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [39.627506, -105.71251],
  [39.59914, -105.70787],
  [39.554554, -105.72435],
  [39.56342, -105.73543],
  [39.571228, -105.737144],
  [39.577976, -105.72255]],
 ["Mount Lugo",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [39.546146, -105.2731],
  [39.53625, -105.28069],
  [39.53506, -105.27902],
  [39.534397, -105.272675],
  [39.534332, -105.26537]],
 ["Pikes Peak/Glen Cove",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [38.88729, -105.07136],
  [38.87159, -105.082214],
  [38.86581, -105.07792],
  [38.86668, -105.06706],
  [38.87981, -105.06402]],
 ["Conquistador",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [38.13307, -105.575096],
  [38.132732, -105.577415],
  [38.12227, -105.594574],
  [38.114906, -105.59792],
  [38.11133, -105.59715],
  [38.10991, -105.594406],
  [38.11761, -105.58162]],
 ["Cuchara",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [37.35167, -105.12744],
  [37.348362, -105.13298],
  [37.34075, -105.13873],
  [37.33478, -105.1389],
  [37.33949, -105.125725],
  [37.343822, -105.122894],
  [37.34904, -105.1241]],
 ["Lizard Head Pass",
  "Powder Ghost Towns",
  "http://www.peterbronski.com/Writing/PowderGhostTowns.html",
  [37.810867, -107.87021],
  [37.800495, -107.88591],
  [37.811207, -107.90866],
  [37.824295, -107.919815],
  [37.82633, -107.9078],
  [37.833244, -107.904106],
  [37.834057, -107.89596],
  [37.83365, -107.88754]],
 ["Mount Sherman",
  "Dawson’s Guide to Colorado’s Fourteeners – Volume 1",
  "http://www.bluecloverpress.com/books/fourteener1.html",
  [39.22667, -106.194534],
  [39.226204, -106.16973],
  [39.195213, -106.13707],
  [39.212574, -106.17875]],
 ["Peak 1 – Canyon Gully",
  "Making Turns in the Tenmile•Mosquito Range",
  "http://www.giterdunpublishing.com/makingturns-in-the-tenmile-mosquito-range/",
  [39.57533, -106.11197],
  [39.569637, -106.11686],
  [39.564346, -106.12948],
  [39.555477, -106.13102],
  [39.54297, -106.12046],
  [39.555943, -106.12939],
  [39.563553, -106.1281],
  [39.569042, -106.11634]],
 ["Royal Mountain to Tenmile Peak",
  "Making Turns in the Tenmile•Mosquito Range",
  "http://www.giterdunpublishing.com/makingturns-in-the-tenmile-mosquito-range/",
  [39.570633, -106.10107],
  [39.56944, -106.10905],
  [39.565105, -106.112434],
  [39.56021, -106.11261],
  [39.555775, -106.11596],
  [39.553032, -106.11506],
  [39.539494, -106.12188],
  [39.53589, -106.12119],
  [39.531948, -106.11626],
  [39.531055, -106.100464],
  [39.536583, -106.08197],
  [39.562428, -106.0845],
  [39.56706, -106.0815],
  [39.56772, -106.082695],
  [39.56752, -106.083725],
  [39.570763, -106.08527],
  [39.567192, -106.09051]],
 ["Terrain Park",
  "Climbing Life",
  "http://climbinglife.com/snow/rmnp-backcountry-skiing-areas/343-terrain-park-skiing",
  [40.304337, -105.66483],
  [40.309544, -105.66183],
  [40.310818, -105.6511],
  [40.30496, -105.64986],
  [40.293438, -105.6532],
  [40.2937, -105.65895]],
 ["Mt Tweto & Mt Arkansas",
  "Making Turns in the Tenmile•Mosquito Range",
  "http://www.giterdunpublishing.com/makingturns-in-the-tenmile-mosquito-range/",
  [39.359985, -106.18157],
  [39.341133, -106.18209],
  [39.337685, -106.179344],
  [39.33224, -106.17848],
  [39.328655, -106.177795],
  [39.32726, -106.17325],
  [39.32228, -106.1699],
  [39.325005, -106.16509],
  [39.326862, -106.15626],
  [39.340073, -106.154106],
  [39.34724, -106.1602],
  [39.36025, -106.17969]]];

    var mapOptions = {
        center: new google.maps.LatLng(44.5, -115),
        zoom: 6,
        mapTypeId: google.maps.MapTypeId.TERRAIN
    };
    var map = new google.maps.Map(document.getElementById("map-canvas"),
                                  mapOptions);

    quadrants.map(function(quad) {
                      var zip = boundsImage(quad[0], quad[1]);
                      var bounds = zip[0];
                      var file = zip[1];
                 
                      var avyOverlay = new google.maps.GroundOverlay(file,
                                                                     bounds,
                                                                     {opacity: 0.5});
                      avyOverlay.setMap(map);
                  });
    var infowindow = new google.maps.InfoWindow();
    skiAreas.map(function(path) {
                     var area = path.shift();
                     var guidebook = path.shift();
                     var url = path.shift();
                     var latlng = path.map(function(coords) {
                                               return new google.maps.LatLng(coords[0], coords[1]);
                                           });
                     var areaPolygon = new google.maps.Polygon({paths: latlng,
                                                                strokeColor: '#0000FF',
                                                                strokeOpacity: 0.8,
                                                                strokeWeight: 2,
                                                                clickable: true});
                     areaPolygon.setMap(map);

                     google.maps.event.addListener(areaPolygon,
                                                   'click',
                                                   function(event) {
                                                       var contentString = '<div id="content:">' + area + '<br>Guide: <a href="' + url + '">' + guidebook + '</a></div>';
                                                       infowindow.setContent(contentString);
                                                       infowindow.setPosition(event.latLng);
                                                       infowindow.open(map);
                                                   });
                 });
}

google.maps.event.addDomListener(window, 'load', initialize);
